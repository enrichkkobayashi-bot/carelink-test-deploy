
import React from 'react';
import { FaceSheetData, FamilyMember } from '../types';

interface FaceSheetProps {
  data: FaceSheetData;
  onUpdate: (field: keyof FaceSheetData, value: any) => void;
}

const SelectWithDetail = ({ label, value, onChange }: { label: string, value: string, onChange: (val: string) => void }) => {
  const hasIssue = value.startsWith('有');
  const detail = value.replace(/^有[:\s]*|無[:\s]*/, '');

  const handleChange = (newHasIssue: boolean, newDetail: string) => {
    if (!newHasIssue) {
      onChange('無');
    } else {
      onChange(`有${newDetail ? ': ' + newDetail : ''}`);
    }
  };

  return (
    <div className="flex flex-col gap-1">
      <label className="text-[10px] font-bold text-indigo-700">{label}</label>
      <div className="flex gap-2">
        <select
          className="border-b border-indigo-200 outline-none text-sm py-1 bg-transparent focus:border-indigo-500 transition-colors w-20"
          value={hasIssue ? '有' : '無'}
          onChange={(e) => handleChange(e.target.value === '有', detail)}
        >
          <option value="無">無</option>
          <option value="有">有</option>
        </select>
        {hasIssue && (
          <input
            type="text"
            className="border-b border-indigo-200 focus:border-indigo-500 outline-none text-sm py-1 bg-transparent transition-colors flex-1"
            value={detail}
            onChange={(e) => handleChange(true, e.target.value)}
            placeholder="詳細を入力"
          />
        )}
      </div>
    </div>
  );
};

const DropdownAndText = ({ label, value, options, onChange }: { label: string, value: string, options: string[], onChange: (val: string) => void }) => {
  const selectedOption = options.find(opt => value === opt || value.startsWith(opt + ':') || value.startsWith(opt + ' ')) || '';
  const detail = selectedOption ? value.replace(selectedOption, '').replace(/^[:\s]+/, '') : value;

  const handleSelectChange = (newOption: string) => {
    if (newOption === '') {
      onChange('');
      return;
    }
    onChange(newOption + (detail ? ': ' + detail : ''));
  };

  const handleTextChange = (newDetail: string) => {
    if (selectedOption) {
      onChange(selectedOption + (newDetail ? ': ' + newDetail : ''));
    } else {
      onChange(newDetail);
    }
  };

  return (
    <div className="flex flex-col gap-1">
      <label className="text-[10px] font-bold text-indigo-700">{label}</label>
      <div className="flex gap-2">
        <select
          className="border-b border-indigo-200 outline-none text-sm py-1 bg-transparent focus:border-indigo-500 transition-colors"
          value={selectedOption}
          onChange={(e) => handleSelectChange(e.target.value)}
        >
          <option value="">選択</option>
          {options.map(opt => (
            <option key={opt} value={opt}>{opt}</option>
          ))}
        </select>
        <input
          type="text"
          className="border-b border-indigo-200 focus:border-indigo-500 outline-none text-sm py-1 bg-transparent transition-colors flex-1"
          value={detail}
          onChange={(e) => handleTextChange(e.target.value)}
          placeholder="詳細を入力"
        />
      </div>
    </div>
  );
};

const InputField = ({ label, value, field, onUpdate, type = "text", placeholder = "" }: { label: string, value: string, field: keyof FaceSheetData, onUpdate: (field: keyof FaceSheetData, value: any) => void, type?: string, placeholder?: string }) => (
  <div className="flex flex-col gap-1">
    <label className="text-[10px] font-bold text-indigo-700">{label}</label>
    <input
      type={type}
      className="border-b border-indigo-200 focus:border-indigo-500 outline-none text-sm py-1 bg-transparent transition-colors"
      value={value}
      onChange={(e) => onUpdate(field, e.target.value)}
      placeholder={placeholder}
    />
  </div>
);

const SectionTitle = ({ title, pageNumber }: { title: string, pageNumber?: number }) => (
  <div className="flex justify-between items-center bg-indigo-100 px-4 py-2 rounded mb-4">
    <h3 className="text-sm font-bold text-indigo-900">{title}</h3>
    {pageNumber && <span className="text-[10px] text-indigo-400">Page {pageNumber} / 2</span>}
  </div>
);

const FaceSheet: React.FC<FaceSheetProps> = ({ data, onUpdate }) => {
  const [dragTarget, setDragTarget] = React.useState<'genogram' | 'floor' | null>(null);

  const handleFamilyUpdate = (index: number, field: keyof FamilyMember, value: any) => {
    const newFamily = [...data.familyMembers];
    if (field === 'isKeyPerson') {
      newFamily.forEach((m, i) => {
        newFamily[i] = { ...m, isKeyPerson: i === index ? value : false };
      });
    } else {
      newFamily[index] = { ...newFamily[index], [field]: value };
    }
    onUpdate('familyMembers', newFamily);
  };

  const handleImageFile = (field: 'genogramUrl' | 'floorPlanUrl', file: File) => {
    if (!file.type.startsWith('image/')) {
      alert('画像ファイル（.jpg, .png等）をドロップしてください。');
      return;
    }
    const reader = new FileReader();
    reader.onloadend = () => {
      onUpdate(field, reader.result as string);
    };
    reader.readAsDataURL(file);
  };

  const handleImageUpload = (field: 'genogramUrl' | 'floorPlanUrl', e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) handleImageFile(field, file);
  };

  const handleDrop = (field: 'genogramUrl' | 'floorPlanUrl', e: React.DragEvent<HTMLDivElement>) => {
    e.preventDefault();
    e.stopPropagation();
    setDragTarget(null);
    const file = e.dataTransfer.files?.[0];
    if (file) handleImageFile(field, file);
  };

  const handleDragOver = (e: React.DragEvent<HTMLDivElement>, field: 'genogram' | 'floor') => {
    e.preventDefault();
    e.stopPropagation();
    if (dragTarget !== field) {
      setDragTarget(field);
    }
  };

  const handleDragLeave = (e: React.DragEvent<HTMLDivElement>) => {
    e.preventDefault();
    e.stopPropagation();
    setDragTarget(null);
  };

  const handleRemoveImage = (field: 'genogramUrl' | 'floorPlanUrl', e: React.MouseEvent) => {
    e.preventDefault();
    e.stopPropagation();
    onUpdate(field, '');
  };

  return (
    <div className="face-sheet-container bg-white shadow-xl mx-auto max-w-[210mm] print:shadow-none print:mx-0">

      {/* PAGE 1 */}
      <div className="w-[210mm] h-[296mm] p-[10mm] relative box-border overflow-hidden" style={{ pageBreakAfter: 'always' }}>
        <div className="text-center mb-4">
          <h1 className="text-xl font-bold text-indigo-900 border-b-2 border-indigo-500 inline-block px-8 pb-1">フェイスシート（基本情報）</h1>
        </div>

        <div className="space-y-4">
          <section className="pdf-avoid-break">
            <SectionTitle title="1. 相談受付・本人基本情報" pageNumber={1} />
            <div className="grid grid-cols-3 gap-4 mb-4">
              <InputField label="相談日" value={data.consultationDate} field="consultationDate" type="date" onUpdate={onUpdate} />
              <div className="flex flex-col gap-1">
                <label className="text-[10px] font-bold text-indigo-700">来所・電話</label>
                <select className="border-b border-indigo-200 outline-none text-sm py-1 bg-transparent focus:border-indigo-500 transition-colors" value={data.consultationMethod} onChange={(e) => onUpdate('consultationMethod', e.target.value)}>
                  <option value="">選択</option>
                  <option value="来所">来所</option>
                  <option value="電話">電話</option>
                  <option value="訪問">訪問</option>
                </select>
              </div>
              <InputField label="把握経路（紹介元等）" value={data.referralPath} field="referralPath" onUpdate={onUpdate} />
            </div>

            <div className="grid grid-cols-4 gap-4 mb-4">
              <div className="col-span-2"><InputField label="氏名" value={data.userName} field="userName" onUpdate={onUpdate} /></div>
              <div className="flex flex-col gap-1">
                <label className="text-[10px] font-bold text-indigo-700">性別</label>
                <select className="border-b border-indigo-200 outline-none text-sm py-1 bg-transparent focus:border-indigo-500 transition-colors" value={data.userGender} onChange={(e) => onUpdate('userGender', e.target.value)}>
                  <option value="">選択</option>
                  <option value="男">男</option>
                  <option value="女">女</option>
                </select>
              </div>
              <InputField label="年齢" value={data.userAge} field="userAge" type="number" onUpdate={onUpdate} />
            </div>

            <div className="grid grid-cols-4 gap-4 mb-4">
              <div className="col-span-2"><InputField label="生年月日" value={data.userDob} field="userDob" type="date" onUpdate={onUpdate} /></div>
              <div className="col-span-2"><InputField label="連絡先 (TEL/FAX)" value={data.userTel} field="userTel" onUpdate={onUpdate} /></div>
            </div>

            <div className="mb-4"><InputField label="住所" value={data.userAddress} field="userAddress" onUpdate={onUpdate} /></div>

            <div className="grid grid-cols-2 gap-4 mb-4">
              <InputField label="緊急連絡先1" value={data.emergencyContact1} field="emergencyContact1" onUpdate={onUpdate} />
              <InputField label="緊急連絡先2" value={data.emergencyContact2} field="emergencyContact2" onUpdate={onUpdate} />
            </div>

            <div className="grid grid-cols-4 gap-4">
              <div className="flex flex-col gap-1">
                <label className="text-[10px] font-bold text-indigo-700">要介護度</label>
                <select className="border-b border-indigo-200 outline-none text-sm py-1 bg-transparent focus:border-indigo-500 transition-colors" value={data.careLevel} onChange={(e) => onUpdate('careLevel', e.target.value)}>
                  <option value="未申請">未申請</option>
                  <option value="自立">自立</option>
                  <option value="要支援1">要支援1</option>
                  <option value="要支援2">要支援2</option>
                  <option value="要介護1">要介護1</option>
                  <option value="要介護2">要介護2</option>
                  <option value="要介護3">要介護3</option>
                  <option value="要介護4">要介護4</option>
                  <option value="要介護5">要介護5</option>
                </select>
              </div>
              <InputField label="認定期限" value={data.carePeriod} field="carePeriod" type="date" onUpdate={onUpdate} />
              <InputField label="障害等認定" value={data.disabilityLevel} field="disabilityLevel" onUpdate={onUpdate} />
              <InputField label="経済状況（年金等）" value={data.economicStatus} field="economicStatus" onUpdate={onUpdate} />
            </div>
          </section>

          <section className="pdf-avoid-break">
            <SectionTitle title="2. 家族の情報" />
            <div className="overflow-x-auto mb-4">
              <table className="min-w-full border-collapse border border-indigo-200 text-xs">
                <thead className="bg-indigo-50 text-indigo-900">
                  <tr>
                    <th className="border border-indigo-200 px-1 py-1 w-8">KP</th>
                    <th className="border border-indigo-200 px-2 py-1">氏名/続柄</th>
                    <th className="border border-indigo-200 px-2 py-1">年齢/性別</th>
                    <th className="border border-indigo-200 px-2 py-1">住所/連絡先</th>
                    <th className="border border-indigo-200 px-2 py-1">健康状態</th>
                  </tr>
                </thead>
                <tbody>
                  {data.familyMembers.map((m, idx) => (
                    <tr key={idx}>
                      <td className="border border-indigo-200 p-1 text-center">
                        <input
                          type="checkbox"
                          className="w-4 h-4 cursor-pointer accent-indigo-600"
                          checked={m.isKeyPerson || false}
                          onChange={(e) => handleFamilyUpdate(idx, 'isKeyPerson', e.target.checked)}
                          title="キーパーソン"
                        />
                      </td>
                      <td className="border border-indigo-200 p-1">
                        <input className="w-full outline-none mb-1 font-bold text-gray-800 bg-transparent" value={m.name} onChange={(e) => handleFamilyUpdate(idx, 'name', e.target.value)} placeholder="氏名" />
                        <input className="w-full outline-none text-[10px] text-gray-500 bg-transparent" value={m.relationship} onChange={(e) => handleFamilyUpdate(idx, 'relationship', e.target.value)} placeholder="続柄" />
                      </td>
                      <td className="border border-indigo-200 p-1">
                        <input className="w-full outline-none mb-1 bg-transparent" value={m.age} onChange={(e) => handleFamilyUpdate(idx, 'age', e.target.value)} placeholder="年齢" />
                        <input className="w-full outline-none bg-transparent" value={m.gender} onChange={(e) => handleFamilyUpdate(idx, 'gender', e.target.value)} placeholder="性別" />
                      </td>
                      <td className="border border-indigo-200 p-1">
                        <input className="w-full outline-none mb-1 bg-transparent" value={m.address} onChange={(e) => handleFamilyUpdate(idx, 'address', e.target.value)} placeholder="住所" />
                        <input className="w-full outline-none bg-transparent" value={m.tel} onChange={(e) => handleFamilyUpdate(idx, 'tel', e.target.value)} placeholder="電話" />
                      </td>
                      <td className="border border-indigo-200 p-1">
                        <textarea className="w-full outline-none h-12 resize-none bg-transparent" value={m.healthStatus} onChange={(e) => handleFamilyUpdate(idx, 'healthStatus', e.target.value)} placeholder="健康状態..." />
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </section>

          <section className="pdf-avoid-break">
            <SectionTitle title="3. 現在利用中のサービス" />
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div className="flex flex-col">
                <label className="text-[10px] font-bold text-indigo-700 block mb-1">フォーマルサービス（介護保険等）</label>
                <textarea className="w-full border border-indigo-200 rounded p-2 text-sm h-16 resize-none bg-transparent focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200 outline-none transition-colors" value={data.formalService} onChange={(e) => onUpdate('formalService', e.target.value)} placeholder="例：訪問介護、通所介護、福祉用具貸与など" />
              </div>
              <div className="flex flex-col">
                <label className="text-[10px] font-bold text-indigo-700 block mb-1">インフォーマルサービス（社会資源等）</label>
                <textarea className="w-full border border-indigo-200 rounded p-2 text-sm h-16 resize-none bg-transparent focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200 outline-none transition-colors" value={data.informalService} onChange={(e) => onUpdate('informalService', e.target.value)} placeholder="例：配食、ボランティア、家族・近隣の協力など" />
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 print:grid-cols-2 gap-4 h-[150px]">
              <div className="flex flex-col h-full">
                <div className="flex justify-between items-center mb-1">
                  <label className="text-[10px] font-bold text-indigo-700 block truncate">ジェノグラム（家系図）</label>
                  <a href="https://genogram-architect-copy.vercel.app" target="_blank" rel="noopener noreferrer" className="text-[10px] text-indigo-500 hover:text-indigo-700 underline flex items-center gap-1 print:hidden">
                    <span>作成ツール</span>
                  </a>
                </div>
                <div
                  className={`border-2 border-dashed rounded-xl flex-1 min-h-0 flex flex-col items-center justify-center relative overflow-hidden transition-all duration-200 cursor-pointer
                    ${dragTarget === 'genogram' ? 'border-indigo-500 bg-indigo-100 scale-[1.02]' : 'border-indigo-200 bg-indigo-50/50'}
                  `}
                  onClick={() => document.getElementById('genogram-input')?.click()}
                  onDrop={(e) => handleDrop('genogramUrl', e)}
                  onDragOver={(e) => handleDragOver(e, 'genogram')}
                  onDragLeave={handleDragLeave}
                >
                  {data.genogramUrl ? (
                    <>
                      <img src={data.genogramUrl} className="absolute inset-0 w-full h-full object-contain p-1" alt="Genogram" />
                      <button onClick={(e) => handleRemoveImage('genogramUrl', e)} className="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 print:hidden">
                        <svg className="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M6 18L18 6M6 6l12 12" /></svg>
                      </button>
                    </>
                  ) : <span className="text-[10px] text-indigo-400">画像ドロップ</span>}
                  <input id="genogram-input" type="file" hidden accept="image/*" onChange={(e) => handleImageUpload('genogramUrl', e)} />
                </div>
              </div>
              <div className="flex flex-col gap-2 h-full">
                <div className="h-1/2 flex flex-col">
                  <label className="text-[10px] font-bold text-indigo-700 block mb-1 truncate">本人・家族の意向（本人）</label>
                  <textarea className="w-full border border-indigo-200 rounded p-1 text-[11px] flex-1 resize-none bg-transparent outline-none transition-colors" value={data.userAspiration} onChange={(e) => onUpdate('userAspiration', e.target.value)} />
                </div>
                <div className="h-1/2 flex flex-col">
                  <label className="text-[10px] font-bold text-indigo-700 block mb-1 truncate">本人・家族の意向（家族）</label>
                  <textarea className="w-full border border-indigo-200 rounded p-1 text-[11px] flex-1 resize-none bg-transparent outline-none transition-colors" value={data.familyAspiration} onChange={(e) => onUpdate('familyAspiration', e.target.value)} />
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>

      {/* PAGE 2 */}
      <div className="w-[210mm] h-[296mm] p-[10mm] relative box-border overflow-hidden">
        <div className="text-center mb-4">
          <h1 className="text-xl font-bold text-indigo-900 border-b-2 border-indigo-500 inline-block px-8 pb-1">フェイスシート（身体状況・環境）</h1>
        </div>

        <div className="space-y-4">
          <section className="pdf-avoid-break">
            <SectionTitle title="4. 日常生活の自立判定・健康状態" pageNumber={2} />
            <div className="grid grid-cols-2 gap-4 mb-4">
              <div className="flex flex-col gap-1">
                <label className="text-[10px] font-bold text-indigo-700">障害高齢者の日常生活自立度</label>
                <select className="border-b border-indigo-200 outline-none text-sm py-1 bg-transparent focus:border-indigo-500 transition-colors" value={data.physicalIndependence} onChange={(e) => onUpdate('physicalIndependence', e.target.value)}>
                  <option value="">選択</option>
                  <option value="J1">J1</option><option value="J2">J2</option>
                  <option value="A1">A1</option><option value="A2">A2</option>
                  <option value="B1">B1</option><option value="B2">B2</option>
                  <option value="C1">C1</option><option value="C2">C2</option>
                </select>
              </div>
              <div className="flex flex-col gap-1">
                <label className="text-[10px] font-bold text-indigo-700">認知症高齢者の日常生活自立度</label>
                <select className="border-b border-indigo-200 outline-none text-sm py-1 bg-transparent focus:border-indigo-500 transition-colors" value={data.cognitiveIndependence} onChange={(e) => onUpdate('cognitiveIndependence', e.target.value)}>
                  <option value="">選択</option>
                  <option value="自立">自立</option><option value="I">I</option>
                  <option value="IIa">IIa</option><option value="IIb">IIb</option>
                  <option value="IIIa">IIIa</option><option value="IIIb">IIIb</option>
                  <option value="IV">IV</option><option value="M">M</option>
                </select>
              </div>
            </div>

            <div className="grid grid-cols-4 gap-4 mb-4">
              <InputField label="身長(cm)" value={data.height} field="height" type="number" onUpdate={onUpdate} />
              <InputField label="体重(kg)" value={data.weight} field="weight" type="number" onUpdate={onUpdate} />
              <InputField label="BMI" value={data.bmi} field="bmi" onUpdate={onUpdate} />
              <InputField label="血圧" value={data.bloodPressure} field="bloodPressure" onUpdate={onUpdate} />
            </div>

            <div className="grid grid-cols-1 gap-4 mb-4">
              <div className="grid grid-cols-3 gap-4">
                <InputField label="医療機関名" value={data.hospitalName} field="hospitalName" onUpdate={onUpdate} />
                <InputField label="医師名" value={data.doctorName} field="doctorName" onUpdate={onUpdate} />
                <InputField label="電話番号" value={data.doctorContact} field="doctorContact" onUpdate={onUpdate} />
              </div>
            </div>

            <div className="grid grid-cols-1 gap-4 mb-4">
              <div className="flex flex-col gap-1">
                <label className="text-[10px] font-bold text-indigo-700">既往歴・主傷歴</label>
                <textarea className="border border-indigo-200 rounded p-2 text-sm h-12 resize-none bg-transparent focus:border-indigo-500 outline-none transition-colors" value={data.medicalHistory} onChange={(e) => onUpdate('medicalHistory', e.target.value)} />
              </div>
            </div>

            <div className="grid grid-cols-2 gap-4 mb-4">
              <SelectWithDetail label="麻痺・拘縮" value={data.paralysisContracture} onChange={(val) => onUpdate('paralysisContracture', val)} />
              <SelectWithDetail label="痛み・しびれ" value={data.painNumbness} onChange={(val) => onUpdate('painNumbness', val)} />
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div className="flex flex-col gap-1">
                <DropdownAndText
                  label="服薬管理"
                  value={data.medicationStatus}
                  options={["自立", "家族管理", "訪問薬剤師", "一部介助", "全介助"]}
                  onChange={(val) => onUpdate('medicationStatus', val)}
                />
              </div>
              <InputField label="処方薬の種類" value={data.medicationTypes} field="medicationTypes" onUpdate={onUpdate} />
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2">
              <InputField label="感染症" value={data.infections} field="infections" onUpdate={onUpdate} placeholder="肝炎、梅毒など" />
              <InputField label="アレルギー" value={data.allergies} field="allergies" onUpdate={onUpdate} placeholder="食物、薬剤" />
              <InputField label="認知症症状(BPSD)" value={data.bpsdSymptoms} field="bpsdSymptoms" onUpdate={onUpdate} placeholder="不穏、徘徊など" />
            </div>
          </section>

          <section className="pdf-avoid-break">
            <SectionTitle title="5. 生活・居住環境" />
            <div className="grid grid-cols-2 lg:grid-cols-4 gap-2 mb-4">
              <div className="flex flex-col gap-1">
                <label className="text-[10px] font-bold text-indigo-700">居住形態</label>
                <select className="border-b border-indigo-200 outline-none text-xs py-1 bg-transparent focus:border-indigo-500 transition-colors" value={data.housingType} onChange={(e) => onUpdate('housingType', e.target.value)}>
                  <option value="持ち家(戸建)">持ち家(戸建)</option>
                  <option value="持ち家(集合)">持ち家(集合)</option>
                  <option value="借家">借家</option>
                  <option value="公営住宅">公営住宅</option>
                </select>
              </div>
              <div className="flex flex-col gap-1">
                <label className="text-[10px] font-bold text-indigo-700">自室</label>
                <select className="border-b border-indigo-200 outline-none text-xs py-1 bg-transparent focus:border-indigo-500 transition-colors" value={data.hasOwnRoom} onChange={(e) => onUpdate('hasOwnRoom', e.target.value)}><option value="有">有</option><option value="無">無</option></select>
              </div>
              <div className="flex flex-col gap-1">
                <label className="text-[10px] font-bold text-indigo-700">日中独居</label>
                <select className="border-b border-indigo-200 outline-none text-xs py-1 bg-transparent focus:border-indigo-500 transition-colors" value={data.isSoloDuringDay} onChange={(e) => onUpdate('isSoloDuringDay', e.target.value)}><option value="無">無</option><option value="有">有</option></select>
              </div>
              <div className="flex flex-col gap-1">
                <label className="text-[10px] font-bold text-indigo-700">浴室</label>
                <select className="border-b border-indigo-200 outline-none text-xs py-1 bg-transparent focus:border-indigo-500 transition-colors" value={data.hasBath} onChange={(e) => onUpdate('hasBath', e.target.value)}><option value="有">有</option><option value="無">無</option></select>
              </div>
            </div>

            <div className="grid grid-cols-2 lg:grid-cols-3 gap-2 mb-4">
              <div className="flex flex-col gap-1">
                <label className="text-[10px] font-bold text-indigo-700">便所</label>
                <select className="border-b border-indigo-200 outline-none text-xs py-1 bg-transparent focus:border-indigo-500 transition-colors" value={data.toiletType} onChange={(e) => onUpdate('toiletType', e.target.value)}><option value="洋式">洋式</option><option value="和式">和式</option><option value="ポータブル">ポータブル</option></select>
              </div>
              <div className="flex flex-col gap-1">
                <label className="text-[10px] font-bold text-indigo-700">段差</label>
                <select className="border-b border-indigo-200 outline-none text-xs py-1 bg-transparent focus:border-indigo-500 transition-colors" value={data.hasSteps} onChange={(e) => onUpdate('hasSteps', e.target.value)}><option value="無">無</option><option value="有(各所にあり)">有(各所にあり)</option><option value="有(一部あり)">有(一部あり)</option></select>
              </div>
              <div className="flex flex-col gap-1">
                <label className="text-[10px] font-bold text-indigo-700">住宅改修</label>
                <select className="border-b border-indigo-200 outline-none text-xs py-1 bg-transparent focus:border-indigo-500 transition-colors" value={data.hasRenovation} onChange={(e) => onUpdate('hasRenovation', e.target.value)}><option value="無">無</option><option value="有(手すり等)">有(手すり等)</option><option value="予定あり">予定あり</option></select>
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 print:grid-cols-2 gap-4 h-[220px] mb-4">
              <div className="flex flex-col h-full">
                <div className="flex justify-between items-center mb-1">
                  <label className="text-[10px] font-bold text-indigo-700 block truncate">間取り図</label>
                  <a href="https://care-plan-app-six.vercel.app" target="_blank" rel="noopener noreferrer" className="text-[10px] text-indigo-500 hover:text-indigo-700 underline flex items-center gap-1 print:hidden">
                    <span>作成ツール</span>
                  </a>
                </div>
                <div
                  className={`border-2 border-dashed rounded-xl flex-1 min-h-0 flex items-center justify-center relative transition-all duration-200 cursor-pointer
                    ${dragTarget === 'floor' ? 'border-indigo-500 bg-indigo-100' : 'border-indigo-200 bg-indigo-50/50'}
                  `}
                  onClick={() => document.getElementById('floorplan-input')?.click()}
                  onDrop={(e) => handleDrop('floorPlanUrl', e)}
                  onDragOver={(e) => handleDragOver(e, 'floor')}
                  onDragLeave={handleDragLeave}
                >
                  {data.floorPlanUrl ? (
                    <>
                      <img src={data.floorPlanUrl} className="absolute inset-0 w-full h-full object-contain p-1" />
                      <button onClick={(e) => handleRemoveImage('floorPlanUrl', e)} className="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 print:hidden">
                        <svg className="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M6 18L18 6M6 6l12 12" /></svg>
                      </button>
                    </>
                  ) : <span className="text-[10px] text-indigo-400">画像ドロップ</span>}
                  <input id="floorplan-input" type="file" hidden accept="image/*" onChange={(e) => handleImageUpload('floorPlanUrl', e)} />
                </div>
              </div>
              <div className="flex flex-col gap-4 h-full">
                <div className="h-1/2 flex flex-col">
                  <label className="text-[10px] font-bold text-indigo-700 block mb-1 text-xs">今までの生活</label>
                  <textarea className="w-full border border-indigo-200 rounded p-1 text-[11px] flex-1 resize-none bg-transparent outline-none transition-colors" value={data.lifeHistory} onChange={(e) => onUpdate('lifeHistory', e.target.value)} />
                </div>
                <div className="h-1/2 flex flex-col">
                  <label className="text-[10px] font-bold text-indigo-700 block mb-1 text-xs">現在の生活状況</label>
                  <textarea className="w-full border border-indigo-200 rounded p-1 text-[11px] flex-1 resize-none bg-transparent outline-none transition-colors" value={data.currentSituation} onChange={(e) => onUpdate('currentSituation', e.target.value)} />
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>
  );
};

export default FaceSheet;
